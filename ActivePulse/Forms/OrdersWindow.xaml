<Window x:Class="ActivePulse.Forms.OrdersWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:ActivePulse.Forms"
        mc:Ignorable="d"
        Title="Мои заказы" Height="600" Width="800"
        WindowStartupLocation="CenterOwner"
        Background="#FF424242">

    <Window.Resources>
        <Style TargetType="Expander" x:Key="DefaultExpanderStyle">
            <Setter Property="Background" Value="#FF555555"/>
            <Setter Property="BorderBrush" Value="#FF777777"/>
            <Setter Property="Margin" Value="5"/>
            <Setter Property="Padding" Value="10"/>
        </Style>

        
        
        <Style x:Key="OrangeTextStyle" TargetType="TextBlock">
            <Setter Property="Foreground" Value="#FFD4A017"/>
        </Style>

        <Style TargetType="ListView">
            <Setter Property="Background" Value="#FF444444"/>
            <Setter Property="BorderThickness" Value="0"/>
        </Style>


        <!-- Конвертер для определения завершенного заказа -->
        <local:ItemTotalConverter x:Key="ItemTotalConverter"/>
        <local:IsCompletedOrderConverter x:Key="IsCompletedOrderConverter"/>
    </Window.Resources>

    <Grid>
        <ScrollViewer>
            <StackPanel>
                <TextBlock Text="Мои заказы" 
                           Foreground="#FFD4A017"
                           FontSize="20"
                           Margin="10"
                           FontWeight="Bold"/>

                <ItemsControl x:Name="OrdersItemsControl">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <Expander Style="{Binding Status, Converter={StaticResource IsCompletedOrderConverter}}" 
                                  Background="#FF555555"
                                  BorderBrush="#FF777777"
                                  Margin="5"
                                  Padding="10">
                                <Expander.Header>
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock Text="{Binding OrderDate, StringFormat='Заказ от {0:dd.MM.yyyy}'}" 
                                                   Foreground="White" FontWeight="Bold"/>
                                        <TextBlock Text="{Binding TotalPrice, StringFormat=' - {0} руб.'}" 
                                                   Foreground="#FFD4A017"
                                                   Margin="10,0,0,0"/>
                                        <TextBlock Text="{Binding Status}" 
                                                   Foreground="{Binding Status, Converter={StaticResource IsCompletedOrderConverter}, ConverterParameter=Foreground}"
                                                   Margin="10,0,0,0"/>
                                    </StackPanel>
                                </Expander.Header>

                                <ListView ItemsSource="{Binding Items}" Margin="10,5">
                                    <ListView.View>
                                        <GridView>
                                            <GridViewColumn Header="Товар" Width="300">
                                                <GridViewColumn.CellTemplate>
                                                    <DataTemplate>
                                                        <TextBlock Text="{Binding Product.ProductName}" 
                                   Style="{StaticResource OrangeTextStyle}"/>
                                                    </DataTemplate>
                                                </GridViewColumn.CellTemplate>
                                            </GridViewColumn>
                                            <GridViewColumn Header="Кол-во" Width="100">
                                                <GridViewColumn.CellTemplate>
                                                    <DataTemplate>
                                                        <TextBlock Text="{Binding Count}" 
                                   Style="{StaticResource OrangeTextStyle}"/>
                                                    </DataTemplate>
                                                </GridViewColumn.CellTemplate>
                                            </GridViewColumn>
                                            <GridViewColumn Header="Цена" Width="100">
                                                <GridViewColumn.CellTemplate>
                                                    <DataTemplate>
                                                        <TextBlock Text="{Binding Price, StringFormat='{}{0} руб.'}" 
                                   Style="{StaticResource OrangeTextStyle}"/>
                                                    </DataTemplate>
                                                </GridViewColumn.CellTemplate>
                                            </GridViewColumn>
                                            <GridViewColumn Header="Сумма" Width="120">
                                                <GridViewColumn.CellTemplate>
                                                    <DataTemplate>
                                                        <TextBlock Text="{Binding Path=., Converter={StaticResource ItemTotalConverter}}" 
                                   Style="{StaticResource OrangeTextStyle}"/>
                                                    </DataTemplate>
                                                </GridViewColumn.CellTemplate>
                                            </GridViewColumn>
                                        </GridView>
                                    </ListView.View>
                                </ListView>
                            </Expander>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>

                <TextBlock x:Name="NoOrdersText" 
                           Text="У вас пока нет заказов"
                           Foreground="LightGray"
                           HorizontalAlignment="Center"
                           Margin="20"
                           Visibility="Collapsed"/>
            </StackPanel>
        </ScrollViewer>
    </Grid>
</Window>